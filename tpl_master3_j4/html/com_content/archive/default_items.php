<?php

/**
 * @package     Joomla.Site
 * @subpackage  com_content
 *
 * @copyright   (C) 2006 Open Source Matters, Inc. <https://www.joomla.org>
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 */

\defined('_JEXEC') or die;

use Joomla\CMS\HTML\HTMLHelper;
use Joomla\CMS\Language\Text;
use Joomla\CMS\Router\Route;
use Joomla\CMS\Layout\LayoutHelper;
use Joomla\Component\Content\Site\Helper\RouteHelper;

$params = $this->params;
?>
<div id="archive-items" class="uk-grid-small uk-grid-divider uk-child-width-1-1 com-content-archive__items" data-uk-grid>
    <?php
    foreach ($this->items as $i => $item) {
        $useDefList = ($params->get('show_modify_date') || $params->get('show_publish_date')
            || $params->get('show_create_date') || $params->get('show_hits')
            || $params->get('show_category') || $params->get('show_parent_category'));
        $info = $item->params->get('info_block_position', 0);
        ?>
        <div class="row<?php echo $i % 2; ?>" itemscope itemtype="https://schema.org/Article">
            <div class="page-header">
                <h2 itemprop="headline">
                    <?php if ($params->get('link_titles')) { ?>
                        <a href="<?php echo Route::_(RouteHelper::getArticleRoute($item->slug, $item->catid, $item->language)); ?>" itemprop="url">
                            <?php echo $this->escape($item->title); ?>
                        </a>
                    <?php } else { ?>
                        <?php echo $this->escape($item->title); ?>
                    <?php } ?>
                </h2>

                <?php // Content is generated by content plugin event "onContentAfterTitle" ?>
                <?php echo $item->event->afterDisplayTitle; ?>

                <?php if ($params->get('show_author') && !empty($item->author) && !$useDefList) { ?>
                    <div class="createdby" itemprop="author" itemscope itemtype="https://schema.org/Person">
                        <?php $author = $item->created_by_alias ?: $item->author; ?>
                        <?php $author = '<span itemprop="name">' . $author . '</span>'; ?>
                        <?php if (!empty($item->contact_link) && $params->get('link_author') == true) { ?>
                            <?php echo Text::sprintf('COM_CONTENT_WRITTEN_BY', HTMLHelper::_('link', $this->item->contact_link, $author, array('itemprop' => 'url'))); ?>
                        <?php } else { ?>
                            <?php echo Text::sprintf('COM_CONTENT_WRITTEN_BY', $author); ?>
                        <?php } ?>
                    </div>
                <?php } ?>
            </div>

            <?php
            if ($useDefList && ($info == 0 || $info == 2)) {
                echo LayoutHelper::render('joomla.content.info_block', array('item' => $item, 'params' => $params, 'position' => 'above'));
            }

            // Content is generated by content plugin event "onContentBeforeDisplay"
            echo $item->event->beforeDisplayContent;
            if ($params->get('show_intro')) {
            ?>
                <div class="intro" itemprop="articleBody"><?php echo HTMLHelper::_('string.truncateComplex', $item->introtext, $params->get('introtext_limit')); ?></div>
            <?php
            }

            if ($useDefList && $info == 1) {
                echo LayoutHelper::render('joomla.content.info_block', array('item' => $this->item, 'params' => $params, 'position' => 'below'));
            }
            // Content is generated by content plugin event "onContentAfterDisplay"
            echo $item->event->afterDisplayContent;
            ?>
        </div>
    <?php } ?>
</div>

<div class="uk-flex uk-flex-between@m uk-flex-middle uk-flex-wrap uk-margin-top navigation">
    <div class="com-content-category-blog__pagination">
        <?php echo $this->pagination->getPagesLinks(); ?>
    </div>
    <?php if ($this->params->def('show_pagination_results', 1)) { ?>
        <div class="counter">
            <?php echo $this->pagination->getPagesCounter(); ?>
        </div>
    <?php } ?>
</div>
